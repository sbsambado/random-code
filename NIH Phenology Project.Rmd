---
title: "Phenology NIH"
author: "sbsambado"
date: "8/19/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r Kurtenbach 2006}
rnaught <- function(t, x, params) {
  
  N = x[1]
  H = x[2]
  R0 = x[3]
  
  f = params[1]
  B = params[2]
  p = params[3]
  n = params[4]
  F = params[5]
  r = params[6]
  h = params[7]
  
  R0 = (N*f*B*(p^n)*F)/(H*(r+h))
  
  return(list(R0))
}
  N0 = 100
  H0 = 20
  
  initial_values = c(N = N0, H = H0)
  f = .8
  B = .9
  p = .7
  n = .3
  F = .4
  r = .1
  h = .01
  
  parameters = c(f, B, p, n, F, r, h)
  
  times = seq(0, 60, length.out = 10000)
  
  results = lsoda(initial_values, times, rnaught, parameters)
  head(results)

  Ncol = 'red'
  Hcol = 'blue'
  
  plot(x = results[,'time'], y = results[,'N'], type = 'l', col = Ncol)
  


```

```{r}
library(readr)
gw <- read.csv("~/Desktop/Questing_Ticks_NIH.csv")
#View(gw)

library(tidyverse)


gw %>%
  select(state, nymph, bb_pos_nymphs) %>%
  mutate(rate = bb_pos_nymphs / nymph *100)


gw$rate = (gw$bb_pos_nymphs / gw$nymph)*100



plot(rate ~ state, data = gw,
     xlab = 'state', ylab = '% BB positive',
     main = 'Gatewood 2009')

region = factor(gw$state, levels = c('MN','WI','IL', 'MI','IN',
                                'ME','NY','NJ','PA', 'MD','VT'))

plot(rate ~ region, data = gw,
     xlab = 'state', ylab = '% BB positive',
     main = 'Gatewood 2009')
abline(v = 5.5, col = 'blue')
text(x = 3, y = 55, "Midwest", font = 2)
text(x = 8.6, y = 55, "Northeast", font = 2)

levels(gw$state) <- list(midwest = c('MN', 'WI', 'IL', 'IN','MI'),
                         northeast = c('ME','NJ','NY','PA', 'MD','VT'))

gw$percent = gw$bb_pos_nymphs / gw$nymph *100
boxplot(gw$percent ~ gw$state)

color = rep(NA, length = length(gw$state))
color[which(gw$state == 'IL')] = 'purple'




```

```{r 2018 sfsu}
library(readr)
qt18 <- read.csv("~/Desktop/qt18.csv")


qt<-select(qt18, -3,  - 6, - 7, - 8, -9, -10)
names(qt) <- c('site', 'collection', 'stage', 'infection')
View(qt)

plot(qt$collection, qt$stage,
     xlab = 'collection date', ylab = 'proportion of life stage')

library(dplyr)
larval = subset(qt, stage == 'L')
View(larval)

nymphal = subset(qt, stage == 'N')
adult = subset(qt, stage == 'A')

par(mfrow = c(3,1))
plot(larval$collection, 
     main = 'Larvae')
plot(nymphal$collection, main = 'Nymphs')
plot(adult$collection, main = 'Adults')
par(mfrow = c(1,1))

bm_inf = subset(qt, infection == 'B. miyamotoi')



count(qt, stage == 'L') # 901
count(qt, stage == 'N') # 283
count(qt, stage == 'A') # 85

count(qt, infection == 'B. miyamotoi') #25
count(qt, infection == 'B. burgdorferi') #28

count(qt, stage == 'L' & infection == 'B. miyamotoi') # 1
count(qt, stage == 'N' & infection == 'B. miyamotoi') # 12
count(qt, stage == 'A' & infection == 'B. miyamotoi') # 12


count(qt, stage == 'N' & infection == 'B. burgdorferi') #26
count(qt, stage == 'A' & infection == 'B. burgdorferi') #2

print(c(
bm_n = (12/283)*100,
bb_n = (26/283)*100,

bm_a = (12/85)*100,
bb_a = (2/85)*100))
```

```{r NEON upload data MI and MD}
library(devtools)
#install.packages("neonUtilities")
library(neonUtilities)
#install.packages('raster')
library(raster)
devtools::install_github('NEONScience/NEON-geolocation/geoNEON')
#install.packages('BiocManager')
BiocManager::install('rhdf5')

#install.packages('geoNEON')
library(geoNEON)
library(rhdf5)
options(stringsAsFactors= FALSE)
stackByTable("~/Desktop/NEON_pathogens-tick.zip")

tick <-loadByProduct(dpID = 'DP1.10092.001', site = 'all',package = 'expanded')

str(tick)
View(tick)
as.data.frame(tick)
readTableNEON(tick, varFile = "~/random-code")
?readTableNEON
list2env(tick, .GlobalEnv) # extrac each table from list to work as independent object
View(tick$tck_pathogen) #list of data frames

help("readTableNEON")

```

